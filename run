#!/usr/bin/env nu
 
def "main web" [] {
  let server_port = (port 8080);
  cd ours
  cargo run -- ~/ $server_port
}

def "main desk" [] {
  cd ours/
  cargo run
}

def "main build" [target? : string] {
  mut args = []
  if $target != null {
     $args = [$"--target=($target)"]
  } 
  cd ./site
  trunk build --release
  cd ..
  ls site_assets/gen | get name | par-each {|x| gzip $x} 
  cd ours
  cargo build ...($args) --release
}

def "main install" [] {
  main build 
  cargo install --path ./ours
}

def main [] {}
