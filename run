#!/usr/bin/env nu
 
let server_port = (port 8080);

def "main web" [] {
  $server_port out> ./site/src/port.txt
  cd ours
  job spawn {
    cargo run -- ~/ $server_port
  }
  cd ../site/
  trunk serve --port (port 1024) --open
}

def "main build" [] {
  cd ./site
  trunk build --release
  cd ..
  ls site_assets/gen | get name | par-each {|x| gzip $x} 
  cd ours
  cargo build --release
  # rm ../assets/temp -rf
}

def "main install" [] {
  main build 
  cargo install --path ./ours
}

def main [] {}
